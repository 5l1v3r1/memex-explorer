{% extends "base/base.html" %}

{% block title %}{{project.name}}{% endblock %}

{% load static %}

{% block extrafooter %}
    <script src="{% static 'base/js/ajax.js' %}"></script>
    <script src="{% static 'base/js/project.js' %}"></script>
    <script src="{% static 'base/js/form_ajax.js' %}"></script>
{% endblock %}

{% block content %}

<script>
  $( document ).ready(function() {
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>


{% include "base/sidebar.html" %}

<div class='row'>
<div class="col-md-offset-2 col-md-4">
  <ol class="breadcrumb">
    <li> <a href="/"> / My Projects / </a></li> {{ project.name }}
  </ol>
</div>
  <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <h1>{{ project.name }}
    <a href="{% url 'base:project_settings' project_slug=project.slug %}">
      <button id="editButton" title="Edit Project" type="button" class="btn btn-control"
      data-container="body"
      data-toggle="tooltip" data-placement="bottom">
      <i class="fa fa-pencil" style="font-size:24px;"></i>
    </button></a>
  </h1>
  <p>{{ project.description }}</p>
</div>
</div>

<div class='row'>
  <div class="col-md-8 col-md-offset-3 main">
    <div class="row">
          <div class="btn-group" role="group" aria-label="...">
             <a id="link-add-crawl" class="btn btn-default btn-duo center link-button" href="{% url 'base:crawl_space:add_crawl' project_slug=project.slug %}">Add Crawl</a>

            <a class="add_index btn btn-default btn-duo center link-button" href="{% url 'base:add_index' project_slug=project.slug %}">Add Dataset</a>

            <a class="btn btn-default btn-duo center link-button" href="{% url 'base:crawl_space:add_crawl_model' project_slug=project.slug %}">Add Crawl Model</a>
          </div>

    </div>

    <div class="row">
      <h4 style="line-height:2em;">
        <!-- <a id="link-crawls" href="{% url 'base:crawl_space:crawls' project_slug=project.slug %}"> -->
          <i class="fa fa-search"> &nbsp; </i>Crawls
        <!-- </a> -->

      </h4>

<!--
      {% if project.crawl_set.all %}
      <ul class="list-group">
        {%  for w in project.crawl_set.all %}
        <li class="list-group-item">
          <a href="{{ w.get_absolute_url }}">{{ w.name }}</a>
        </li>
        {% endfor %}
       </ul>
      {% else %}
      <p>No Crawls Registered.</p>
      {% endif %}
-->
      {% if project.crawl_set.all %}
      <table class="table table-condensed table-striped ">
        <tr>
          <th>Crawl</th>
          <th>Status</th>
          <th>Crawl Count</th>
        </tr>
        {%  for w in project.crawl_set.all %}
        <tr>


          <td><a href="{{ w.get_absolute_url }}">{{ w.name }}</a></td>
          <td>{{ w.status}}</td>
          <td>{{ w.pages_crawled }}</td>

        </tr>
        {% endfor %}
       </table>
      {% else %}
      <p>No Crawls Registered.</p>
      {% endif %}
    </div>
    <hr/>

    <div class="row">
      <h4 style="line-height:2em;">
        <!--<a href="{% url 'base:indices' project_slug=project.slug %}"> -->
          <i class="fa fa-archive"> &nbsp; </i>Datasets
        </a>


        <a id="gotoKibana"
            class="btn btn-default btn-duo center link-button" href="{{ kibana }}">
            Visualize
        </a>
      </h4>
<!--
      {% if project.index_set.all %}
      <ul id="statuses" class="list-group">
        {%  for w in project.index_set.all %}
        <li class="list-group-item">
            <a target="_blank" href={% url 'base:index_settings' project_slug=project.slug index_slug=w.slug %}>
                &nbsp{{ w.name }}
            </a>
            <p id={{ w.slug }} style="float:right;">{{ w.status }}</p>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>No Datasets Registered.</p>
      {% endif %}
-->

      {% if project.index_set.all %}
      <table id="statuses" class="table table-condensed table-striped">
        <tr>
          <th>Name</th>
          <th>Status</th>
        </tr>
        {%  for w in project.index_set.all %}
        <tr>
          <td>
            <a href={% url 'base:index_settings' project_slug=project.slug index_slug=w.slug %}>
                &nbsp{{ w.name }}
            </a>
          </td>
          <td>
            <p id={{ w.slug }} style="float:right;">{{ w.status }}</p>
          </td>
        </tr>
        {% endfor %}
      </table>
      {% else %}
      <p>No Datasets Registered.</p>
      {% endif %}
    </div>
    <hr/>

    <div class="row">
      <h4 style="line-height:2em;">
          <i class="fa fa-bar-chart"> &nbsp; </i>Crawl Models
        &nbsp;&nbsp;&nbsp;


      </h4>
<!--
        {% if project.crawlmodel_set.all %}
        <ul class="list-group">
          {% for x in project.crawlmodel_set.all %}
          <li class="list-group-item">
                {{ x.name }}
                <form action="{% url 'base:crawl_space:delete_crawl_model' project_slug=project.slug model_slug=x.slug %}"
                method="post" onSubmit="return confirm('Are you sure you want to delete this crawl model?')">
                    {% csrf_token %}
                <button class="fa fa-trash-o" type="submit"></button>
                </form>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p>No Crawl Models Registered.</p>
        {% endif %}
-->


        {% if project.crawlmodel_set.all %}
        <table class="table table-striped table-condensed">
          <tr>
            <th>Name</th>
            <th>Action</th>
          </tr>
          {% for x in project.crawlmodel_set.all %}
            <tr>
              <td>
                {{ x.name }}
              </td>
              <td>
                <form action="{% url 'base:crawl_space:delete_crawl_model' project_slug=project.slug model_slug=x.slug %}"
                method="post" onSubmit="return confirm('Are you sure you want to delete this crawl model?')">
                    {% csrf_token %}
                <button class="fa fa-trash-o" type="submit"></button>
                </form>
              </td>
          </tr>
          {% endfor %}
        </table>
        {% else %}
        <p>No Crawl Models Registered.</p>
        {% endif %}
  <form method="post" enctype="multipart/form-data" id="addCrawlForm">
    <input type='hidden' name='csrfmiddlewaretoken' value='ZTHcCrWDuqpE9gXoyDK4cSJ5fWKhjc6c' />
    <fieldset>
      <div id="div_id_name" class="form-group">
        <label for="id_name" class="control-label  requiredField">
  				Name<span class="asteriskField">*</span>
        </label>
        <div class="controls ">
          <input class="textinput textInput form-control" id="id_name" maxlength="64" name="name" type="text" />
        </div>
      </div>
      <div id="div_id_description" class="form-group">
        <label for="id_description" class="control-label ">
  				Description
  			</label>
        <div class="controls ">
          <textarea class="textarea form-control" cols="40" id="id_description" name="description" rows="10"></textarea>
        </div>
      </div>
      <div id="div_id_seeds_list" class="form-group">
        <label for="id_seeds_list" class="control-label  requiredField">
  				Seeds list<span class="asteriskField">*</span>
        </label>
        <div class="controls ">
          <input class="clearablefileinput" id="id_seeds_list" name="seeds_list" type="file" />
        </div>
      </div>
      <label for="id_textseeds" class="">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        Or, paste  urls to crawl.
      </label>
      <div class="controls ">
        <textarea class="textarea form-control" cols="10" id="id_textseeds" name="textseeds"rows="10"></textarea>
      </div><br>
      <div id="div_id_crawler" class="form-group">
        <label for="id_crawler"  class="control-label  requiredField">
                  Crawler<span class="asteriskField">*</span>
        </label>
        <div class="controls ">
          <label class="radio-inline">
            <input type="radio" checked="checked" name="crawler" id="id_crawler_1" value="nutch" >Nutch
          </label>
          <label class="radio-inline">
            <input type="radio" name="crawler" id="id_crawler_2" value="ache" >ACHE
          </label>
        </div>
      </div>
      <div id="div_id_rounds_left" class="form-group">
        <label for="id_rounds_left" class="control-label ">
  				Rounds
  			</label>
        <div class="controls ">
          <input class="numberinput form-control" id="id_rounds_left" name="rounds_left" type="number" value="1" />
        </div>
      </div>
      <div id="div_id_crawl_model" class="form-group">
        <label for="id_crawl_model" class="control-label ">
  				Crawl model
  			</label>
        <div class="controls ">
          <select class="select form-control" id="id_crawl_model" name="crawl_model">
            <option value="" selected="selected">---------</option>
            {% for w in project.crawlmodel_set.all %}
              <option value="{{ w }}" selected="selected">{{ w }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="form-actions">
        <input type="submit" name="submit" value="Create" class="btn btn-primary" id="submit-id-submit" />
      </div>
      <a class="add_index btn btn-primary link-button" id="cancelSubmit" target="_blank" href="#">
        Cancel
      </a>
    </fieldset>
  </form>
      </div>
    </div>
  </div>
{% endblock %}
